$(function(){var e=100,r=50,t=50;var i;var n,o,a;var s,l,c=0;var f=0,p=0;var u=window.innerWidth/2;var d=window.innerHeight/2;E();m();function E(){i=document.createElement("div");i.style.position="fixed";i.style.top="0px";i.style.left="0px";i.style.zIndex="-1";i.style.opacity="0.5";document.body.appendChild(i);n=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e4);n.position.z=1e3;o=new THREE.Scene;s=new Array;var c=Math.PI*2;var f=new THREE.SpriteCanvasMaterial({color:10263708,program:function(e){e.beginPath();e.arc(0,0,.5,0,c,true);e.fill()}});var p=0;for(var u=0;u<r;u++){for(var d=0;d<t;d++){l=s[p++]=new THREE.Sprite(f);l.position.x=u*e-r*e/2;l.position.z=d*e-t*e/2;o.add(l)}}a=new THREE.CanvasRenderer;a.setPixelRatio(window.devicePixelRatio);a.setSize(window.innerWidth,window.innerHeight);a.setClearColor(16119801,0);i.appendChild(a.domElement);document.addEventListener("mousemove",v,false);window.addEventListener("resize",h,false)}function h(){u=window.innerWidth/2;d=window.innerHeight/2;n.aspect=window.innerWidth/window.innerHeight;n.updateProjectionMatrix();a.setSize(window.innerWidth,window.innerHeight)}function v(e){f=e.clientX-u}function m(){requestAnimationFrame(m);x()}function x(){n.position.x+=(f-n.position.x)*.05;n.position.y=362.05;n.lookAt({x:o.position.x,y:window.innerHeight/3,z:o.position.z});var e=0;for(var i=0;i<r;i++){for(var p=0;p<t;p++){l=s[e++];l.position.y=Math.sin((i+c)*.3)*50+Math.sin((p+c)*.5)*50;l.scale.x=l.scale.y=(Math.sin((i+c)*.3)+1)*4+(Math.sin((p+c)*.5)+1)*4}}a.render(o,n);c+=.1}});THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0;this.renderOrder=0};THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0;this.renderOrder=0};THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=true};THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld);this.positionScreen.copy(e.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0;this.renderOrder=0};THREE.RenderableSprite=function(){this.id=0;this.object=null;this.x=0;this.y=0;this.z=0;this.rotation=0;this.scale=new THREE.Vector2;this.material=null;this.renderOrder=0};THREE.Projector=function(){var e,r,t=[],i=0,n,o,a=[],s=0,l,c,f=[],p=0,u,d,E=[],h=0,v,m,x=[],R=0,y={objects:[],lights:[],elements:[]},T=new THREE.Vector3,w=new THREE.Vector4,g=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),H=new THREE.Box3,S=new Array(3),M=new Array(4),C=new THREE.Matrix4,b=new THREE.Matrix4,z,V=new THREE.Matrix4,j=new THREE.Matrix3,L=new THREE.Frustum,O=new THREE.Vector4,B=new THREE.Vector4;this.projectVector=function(e,r){console.warn("THREE.Projector: .projectVector() is now vector.project().");e.project(r)};this.unprojectVector=function(e,r){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");e.unproject(r)};this.pickingRay=function(e,r){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var W=function(){var e=[];var r=[];var t=null;var i=null;var o=new THREE.Matrix3;function s(n){t=n;i=t.material;o.getNormalMatrix(t.matrixWorld);e.length=0;r.length=0}function c(e){var r=e.position;var t=e.positionWorld;var i=e.positionScreen;t.copy(r).applyMatrix4(z);i.copy(t).applyMatrix4(b);var n=1/i.w;i.x*=n;i.y*=n;i.z*=n;e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1}function f(e,r,t){n=N();n.position.set(e,r,t);c(n)}function p(r,t,i){e.push(r,t,i)}function d(e,t){r.push(e,t)}function E(e,r,t){if(e.visible===true||r.visible===true||t.visible===true){return true}S[0]=e.positionScreen;S[1]=r.positionScreen;S[2]=t.positionScreen;return g.intersectsBox(H.setFromPoints(S))}function h(e,r,t){return(t.positionScreen.x-e.positionScreen.x)*(r.positionScreen.y-e.positionScreen.y)-(t.positionScreen.y-e.positionScreen.y)*(r.positionScreen.x-e.positionScreen.x)<0}function v(e,r){var i=a[e];var n=a[r];u=A();u.id=t.id;u.v1.copy(i);u.v2.copy(n);u.z=(i.positionScreen.z+n.positionScreen.z)/2;u.renderOrder=t.renderOrder;u.material=t.material;y.elements.push(u)}function m(n,s,c){var f=a[n];var p=a[s];var u=a[c];if(E(f,p,u)===false){return}if(i.side===THREE.DoubleSide||h(f,p,u)===true){l=F();l.id=t.id;l.v1.copy(f);l.v2.copy(p);l.v3.copy(u);l.z=(f.positionScreen.z+p.positionScreen.z+u.positionScreen.z)/3;l.renderOrder=t.renderOrder;l.normalModel.fromArray(e,n*3);l.normalModel.applyMatrix3(o).normalize();for(var d=0;d<3;d++){var v=l.vertexNormalsModel[d];v.fromArray(e,arguments[d]*3);v.applyMatrix3(o).normalize();var m=l.uvs[d];m.fromArray(r,arguments[d]*2)}l.vertexNormalsLength=3;l.material=t.material;y.elements.push(l)}}return{setObject:s,projectVertex:c,checkTriangleVisibility:E,checkBackfaceCulling:h,pushVertex:f,pushNormal:p,pushUv:d,pushLine:v,pushTriangle:m}};var P=new W;this.projectScene=function(t,i,n,s){c=0;d=0;m=0;y.elements.length=0;if(t.autoUpdate===true){t.updateMatrixWorld()}if(i.parent===null){i.updateMatrixWorld()}C.copy(i.matrixWorldInverse.getInverse(i.matrixWorld));b.multiplyMatrices(i.projectionMatrix,C);L.setFromMatrix(b);r=0;y.objects.length=0;y.lights.length=0;function f(r){e=k();e.id=r.id;e.object=r;T.setFromMatrixPosition(r.matrixWorld);T.applyMatrix4(b);e.z=T.z;e.renderOrder=r.renderOrder;y.objects.push(e)}t.traverseVisible(function(e){if(e instanceof THREE.Light){y.lights.push(e)}else{if(e instanceof THREE.Mesh||e instanceof THREE.Line){if(e.material.visible===false){return}if(e.frustumCulled===true&&L.intersectsObject(e)===false){return}f(e)}else{if(e instanceof THREE.Sprite){if(e.material.visible===false){return}if(e.frustumCulled===true&&L.intersectsSprite(e)===false){return}f(e)}}}});if(n===true){y.objects.sort(D)}for(var p=0,E=y.objects.length;p<E;p++){var h=y.objects[p].object;var x=h.geometry;P.setObject(h);z=h.matrixWorld;o=0;if(h instanceof THREE.Mesh){if(x instanceof THREE.BufferGeometry){var R=x.attributes;var g=x.groups;if(R.position===undefined){continue}var H=R.position.array;for(var S=0,M=H.length;S<M;S+=3){P.pushVertex(H[S],H[S+1],H[S+2])}if(R.normal!==undefined){var W=R.normal.array;for(var S=0,M=W.length;S<M;S+=3){P.pushNormal(W[S],W[S+1],W[S+2])}}if(R.uv!==undefined){var U=R.uv.array;for(var S=0,M=U.length;S<M;S+=2){P.pushUv(U[S],U[S+1])}}if(x.index!==null){var q=x.index.array;if(g.length>0){for(var J=0;J<g.length;J++){var X=g[J];for(var S=X.start,M=X.start+X.count;S<M;S+=3){P.pushTriangle(q[S],q[S+1],q[S+2])}}}else{for(var S=0,M=q.length;S<M;S+=3){P.pushTriangle(q[S],q[S+1],q[S+2])}}}else{for(var S=0,M=H.length/3;S<M;S+=3){P.pushTriangle(S,S+1,S+2)}}}else{if(x instanceof THREE.Geometry){var $=x.vertices;var K=x.faces;var Q=x.faceVertexUvs[0];j.getNormalMatrix(z);var Y=h.material;var Z=Y instanceof THREE.MultiMaterial;var _=Z===true?h.material:null;for(var ee=0,re=$.length;ee<re;ee++){var te=$[ee];T.copy(te);if(Y.morphTargets===true){var ie=x.morphTargets;var ne=h.morphTargetInfluences;for(var oe=0,ae=ie.length;oe<ae;oe++){var se=ne[oe];if(se===0){continue}var le=ie[oe];var ce=le.vertices[ee];T.x+=(ce.x-te.x)*se;T.y+=(ce.y-te.y)*se;T.z+=(ce.z-te.z)*se}}P.pushVertex(T.x,T.y,T.z)}for(var fe=0,pe=K.length;fe<pe;fe++){var ue=K[fe];Y=Z===true?_.materials[ue.materialIndex]:h.material;if(Y===undefined){continue}var de=Y.side;var Ee=a[ue.a];var he=a[ue.b];var ve=a[ue.c];if(P.checkTriangleVisibility(Ee,he,ve)===false){continue}var me=P.checkBackfaceCulling(Ee,he,ve);if(de!==THREE.DoubleSide){if(de===THREE.FrontSide&&me===false){continue}if(de===THREE.BackSide&&me===true){continue}}l=F();l.id=h.id;l.v1.copy(Ee);l.v2.copy(he);l.v3.copy(ve);l.normalModel.copy(ue.normal);if(me===false&&(de===THREE.BackSide||de===THREE.DoubleSide)){l.normalModel.negate()}l.normalModel.applyMatrix3(j).normalize();var xe=ue.vertexNormals;for(var Re=0,ye=Math.min(xe.length,3);Re<ye;Re++){var Te=l.vertexNormalsModel[Re];Te.copy(xe[Re]);if(me===false&&(de===THREE.BackSide||de===THREE.DoubleSide)){Te.negate()}Te.applyMatrix3(j).normalize()}l.vertexNormalsLength=xe.length;var we=Q[fe];if(we!==undefined){for(var ge=0;ge<3;ge++){l.uvs[ge].copy(we[ge])}}l.color=ue.color;l.material=Y;l.z=(Ee.positionScreen.z+he.positionScreen.z+ve.positionScreen.z)/3;l.renderOrder=h.renderOrder;y.elements.push(l)}}}}else{if(h instanceof THREE.Line){if(x instanceof THREE.BufferGeometry){var R=x.attributes;if(R.position!==undefined){var H=R.position.array;for(var S=0,M=H.length;S<M;S+=3){P.pushVertex(H[S],H[S+1],H[S+2])}if(x.index!==null){var q=x.index.array;for(var S=0,M=q.length;S<M;S+=2){P.pushLine(q[S],q[S+1])}}else{var He=h instanceof THREE.LineSegments?2:1;for(var S=0,M=H.length/3-1;S<M;S+=He){P.pushLine(S,S+1)}}}}else{if(x instanceof THREE.Geometry){V.multiplyMatrices(b,z);var $=h.geometry.vertices;if($.length===0){continue}Ee=N();Ee.positionScreen.copy($[0]).applyMatrix4(V);var He=h instanceof THREE.LineSegments?2:1;for(var ee=1,re=$.length;ee<re;ee++){Ee=N();Ee.positionScreen.copy($[ee]).applyMatrix4(V);if((ee+1)%He>0){continue}he=a[o-2];O.copy(Ee.positionScreen);B.copy(he.positionScreen);if(G(O,B)===true){O.multiplyScalar(1/O.w);B.multiplyScalar(1/B.w);u=A();u.id=h.id;u.v1.positionScreen.copy(O);u.v2.positionScreen.copy(B);u.z=Math.max(O.z,B.z);u.renderOrder=h.renderOrder;u.material=h.material;if(h.material.vertexColors===THREE.VertexColors){u.vertexColors[0].copy(h.geometry.colors[ee]);u.vertexColors[1].copy(h.geometry.colors[ee-1])}y.elements.push(u)}}}}}else{if(h instanceof THREE.Sprite){w.set(z.elements[12],z.elements[13],z.elements[14],1);w.applyMatrix4(b);var Se=1/w.w;w.z*=Se;if(w.z>=-1&&w.z<=1){v=I();v.id=h.id;v.x=w.x*Se;v.y=w.y*Se;v.z=w.z;v.renderOrder=h.renderOrder;v.object=h;v.rotation=h.rotation;v.scale.x=h.scale.x*Math.abs(v.x-(w.x+i.projectionMatrix.elements[0])/(w.w+i.projectionMatrix.elements[12]));v.scale.y=h.scale.y*Math.abs(v.y-(w.y+i.projectionMatrix.elements[5])/(w.w+i.projectionMatrix.elements[13]));v.material=h.material;y.elements.push(v)}}}}}if(s===true){y.elements.sort(D)}return y};function k(){if(r===i){var e=new THREE.RenderableObject;t.push(e);i++;r++;return e}return t[r++]}function N(){if(o===s){var e=new THREE.RenderableVertex;a.push(e);s++;o++;return e}return a[o++]}function F(){if(c===p){var e=new THREE.RenderableFace;f.push(e);p++;c++;return e}return f[c++]}function A(){if(d===h){var e=new THREE.RenderableLine;E.push(e);h++;d++;return e}return E[d++]}function I(){if(m===R){var e=new THREE.RenderableSprite;x.push(e);R++;m++;return e}return x[m++]}function D(e,r){if(e.renderOrder!==r.renderOrder){return e.renderOrder-r.renderOrder}else{if(e.z!==r.z){return r.z-e.z}else{if(e.id!==r.id){return e.id-r.id}else{return 0}}}}function G(e,r){var t=0,i=1,n=e.z+e.w,o=r.z+r.w,a=-e.z+e.w,s=-r.z+r.w;if(n>=0&&o>=0&&a>=0&&s>=0){return true}else{if(n<0&&o<0||a<0&&s<0){return false}else{if(n<0){t=Math.max(t,n/(n-o))}else{if(o<0){i=Math.min(i,n/(n-o))}}if(a<0){t=Math.max(t,a/(a-s))}else{if(s<0){i=Math.min(i,a/(a-s))}}if(i<t){return false}else{e.lerp(r,t);r.lerp(e,1-i);return true}}}}};THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(e,r){};this.setValues(e)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;e.copy(this);e.color.copy(this.color);e.program=this.program;return e};THREE.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",THREE.REVISION);e=e||{};var r=this,t,i,n,o=new THREE.Projector,a=e.canvas!==undefined?e.canvas:document.createElement("canvas"),s=a.width,l=a.height,c=Math.floor(s/2),f=Math.floor(l/2),p=0,u=0,d=s,E=l,h=1,v=a.getContext("2d",{alpha:e.alpha===true}),m=new THREE.Color(0),x=e.alpha===true?0:1,R=1,y=0,T=null,w=null,g=null,H=null,S=null,M=[],C,b,z,V,j,L=new THREE.RenderableVertex,O=new THREE.RenderableVertex,B,W,P,k,N,F,A,I,D,G,U,q,J=new THREE.Color,X=new THREE.Color,$=new THREE.Color,K=new THREE.Color,Q=new THREE.Color,Y=new THREE.Color,Z=new THREE.Color,_=new THREE.Color,ee={},re,te,ie,ne,oe,ae,se,le,ce=new THREE.Box2,fe=new THREE.Box2,pe=new THREE.Box2,ue=new THREE.Color,de=new THREE.Color,Ee=new THREE.Color,he=new THREE.Vector3,ve=new THREE.Vector3,me=new THREE.Vector3,xe=new THREE.Matrix3;if(v.setLineDash===undefined){v.setLineDash=function(){}}this.domElement=a;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getContext=function(){return v};this.getContextAttributes=function(){return v.getContextAttributes()};this.getPixelRatio=function(){return h};this.setPixelRatio=function(e){if(e!==undefined){h=e}};this.setSize=function(e,r,t){s=e*h;l=r*h;a.width=s;a.height=l;c=Math.floor(s/2);f=Math.floor(l/2);if(t!==false){a.style.width=e+"px";a.style.height=r+"px"}ce.min.set(-c,-f);ce.max.set(c,f);fe.min.set(-c,-f);fe.max.set(c,f);R=1;y=0;T=null;w=null;g=null;H=null;S=null;this.setViewport(0,0,e,r)};this.setViewport=function(e,r,t,i){p=e*h;u=r*h;d=t*h;E=i*h};this.setScissor=function(){};this.setScissorTest=function(){};this.setClearColor=function(e,r){m.set(e);x=r!==undefined?r:1;fe.min.set(-c,-f);fe.max.set(c,f)};this.setClearColorHex=function(e,r){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(e,r)};this.getClearColor=function(){return m};this.getClearAlpha=function(){return x};this.getMaxAnisotropy=function(){return 0};this.clear=function(){if(fe.isEmpty()===false){fe.intersect(ce);fe.expandByScalar(2);fe.min.x=fe.min.x+c;fe.min.y=-fe.min.y+f;fe.max.x=fe.max.x+c;fe.max.y=-fe.max.y+f;if(x<1){v.clearRect(fe.min.x|0,fe.max.y|0,fe.max.x-fe.min.x|0,fe.min.y-fe.max.y|0)}if(x>0){Le(THREE.NormalBlending);je(1);ke("rgba("+Math.floor(m.r*255)+","+Math.floor(m.g*255)+","+Math.floor(m.b*255)+","+x+")");v.fillRect(fe.min.x|0,fe.max.y|0,fe.max.x-fe.min.x|0,fe.min.y-fe.max.y|0)}fe.makeEmpty()}};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(e,a){if(a instanceof THREE.Camera===false){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}var h=e.background;if(h&&h.isColor){ke("rgb("+Math.floor(h.r*255)+","+Math.floor(h.g*255)+","+Math.floor(h.b*255)+")");v.fillRect(0,0,s,l)}else{if(this.autoClear===true){this.clear()}}r.info.render.vertices=0;r.info.render.faces=0;v.setTransform(d/s,0,0,-E/l,p,l-u);v.translate(c,f);t=o.projectScene(e,a,this.sortObjects,this.sortElements);i=t.elements;n=t.lights;C=a;xe.getNormalMatrix(a.matrixWorldInverse);Re();for(var m=0,x=i.length;m<x;m++){var R=i[m];var y=R.material;if(y===undefined||y.opacity===0){continue}pe.makeEmpty();if(R instanceof THREE.RenderableSprite){b=R;b.x*=c;b.y*=f;Te(b,R,y)}else{if(R instanceof THREE.RenderableLine){b=R.v1;z=R.v2;b.positionScreen.x*=c;b.positionScreen.y*=f;z.positionScreen.x*=c;z.positionScreen.y*=f;pe.setFromPoints([b.positionScreen,z.positionScreen]);if(ce.intersectsBox(pe)===true){we(b,z,R,y)}}else{if(R instanceof THREE.RenderableFace){b=R.v1;z=R.v2;V=R.v3;if(b.positionScreen.z<-1||b.positionScreen.z>1){continue}if(z.positionScreen.z<-1||z.positionScreen.z>1){continue}if(V.positionScreen.z<-1||V.positionScreen.z>1){continue}b.positionScreen.x*=c;b.positionScreen.y*=f;z.positionScreen.x*=c;z.positionScreen.y*=f;V.positionScreen.x*=c;V.positionScreen.y*=f;if(y.overdraw>0){Ve(b.positionScreen,z.positionScreen,y.overdraw);Ve(z.positionScreen,V.positionScreen,y.overdraw);Ve(V.positionScreen,b.positionScreen,y.overdraw)}pe.setFromPoints([b.positionScreen,z.positionScreen,V.positionScreen]);if(ce.intersectsBox(pe)===true){ge(b,z,V,0,1,2,R,y)}}}}fe.union(pe)}v.setTransform(1,0,0,1,0,0)};function Re(){ue.setRGB(0,0,0);de.setRGB(0,0,0);Ee.setRGB(0,0,0);for(var e=0,r=n.length;e<r;e++){var t=n[e];var i=t.color;if(t instanceof THREE.AmbientLight){ue.add(i)}else{if(t instanceof THREE.DirectionalLight){de.add(i)}else{if(t instanceof THREE.PointLight){Ee.add(i)}}}}}function ye(e,r,t){for(var i=0,o=n.length;i<o;i++){var a=n[i];_.copy(a.color);if(a instanceof THREE.DirectionalLight){var s=he.setFromMatrixPosition(a.matrixWorld).normalize();var l=r.dot(s);if(l<=0){continue}l*=a.intensity;t.add(_.multiplyScalar(l))}else{if(a instanceof THREE.PointLight){var s=he.setFromMatrixPosition(a.matrixWorld);var l=r.dot(he.subVectors(s,e).normalize());if(l<=0){continue}l*=a.distance==0?1:1-Math.min(e.distanceTo(s)/a.distance,1);if(l==0){continue}l*=a.intensity;t.add(_.multiplyScalar(l))}}}}function Te(e,r,t){je(t.opacity);Le(t.blending);var i=r.scale.x*c;var n=r.scale.y*f;var o=.5*Math.sqrt(i*i+n*n);pe.min.set(e.x-o,e.y-o);pe.max.set(e.x+o,e.y+o);if(t instanceof THREE.SpriteMaterial){var a=t.map;if(a!==null){var s=ee[a.id];if(s===undefined||s.version!==a.version){s=Ce(a);ee[a.id]=s}if(s.canvas!==undefined){ke(s.canvas);var l=a.image;var p=l.width*a.offset.x;var u=l.height*a.offset.y;var d=l.width*a.repeat.x;var E=l.height*a.repeat.y;var h=i/d;var m=n/E;v.save();v.translate(e.x,e.y);if(t.rotation!==0){v.rotate(t.rotation)}v.translate(-i/2,-n/2);v.scale(h,m);v.translate(-p,-u);v.fillRect(p,u,d,E);v.restore()}}else{ke(t.color.getStyle());v.save();v.translate(e.x,e.y);if(t.rotation!==0){v.rotate(t.rotation)}v.scale(i,-n);v.fillRect(-.5,-.5,1,1);v.restore()}}else{if(t instanceof THREE.SpriteCanvasMaterial){Pe(t.color.getStyle());ke(t.color.getStyle());v.save();v.translate(e.x,e.y);if(t.rotation!==0){v.rotate(t.rotation)}v.scale(i,n);t.program(v);v.restore()}}}function we(e,r,t,i){je(i.opacity);Le(i.blending);v.beginPath();v.moveTo(e.positionScreen.x,e.positionScreen.y);v.lineTo(r.positionScreen.x,r.positionScreen.y);if(i instanceof THREE.LineBasicMaterial){Oe(i.linewidth);Be(i.linecap);We(i.linejoin);if(i.vertexColors!==THREE.VertexColors){Pe(i.color.getStyle())}else{var n=t.vertexColors[0].getStyle();var o=t.vertexColors[1].getStyle();if(n===o){Pe(n)}else{try{var a=v.createLinearGradient(e.positionScreen.x,e.positionScreen.y,r.positionScreen.x,r.positionScreen.y);a.addColorStop(0,n);a.addColorStop(1,o)}catch(s){a=n}Pe(a)}}v.stroke();pe.expandByScalar(i.linewidth*2)}else{if(i instanceof THREE.LineDashedMaterial){Oe(i.linewidth);Be(i.linecap);We(i.linejoin);Pe(i.color.getStyle());Ne([i.dashSize,i.gapSize]);v.stroke();pe.expandByScalar(i.linewidth*2);Ne([])}}}function ge(e,t,i,n,o,a,s,l){r.info.render.vertices+=3;r.info.render.faces++;je(l.opacity);Le(l.blending);B=e.positionScreen.x;W=e.positionScreen.y;P=t.positionScreen.x;k=t.positionScreen.y;N=i.positionScreen.x;F=i.positionScreen.y;He(B,W,P,k,N,F);if((l instanceof THREE.MeshLambertMaterial||l instanceof THREE.MeshPhongMaterial)&&l.map===null){Y.copy(l.color);Z.copy(l.emissive);if(l.vertexColors===THREE.FaceColors){Y.multiply(s.color)}J.copy(ue);ve.copy(e.positionWorld).add(t.positionWorld).add(i.positionWorld).divideScalar(3);ye(ve,s.normalModel,J);J.multiply(Y).add(Z);l.wireframe===true?Se(J,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):Me(J)}else{if(l instanceof THREE.MeshBasicMaterial||l instanceof THREE.MeshLambertMaterial||l instanceof THREE.MeshPhongMaterial){if(l.map!==null){var c=l.map.mapping;if(c===THREE.UVMapping){te=s.uvs;be(B,W,P,k,N,F,te[n].x,te[n].y,te[o].x,te[o].y,te[a].x,te[a].y,l.map)}}else{if(l.envMap!==null){if(l.envMap.mapping===THREE.SphericalReflectionMapping){me.copy(s.vertexNormalsModel[n]).applyMatrix3(xe);ie=.5*me.x+.5;ne=.5*me.y+.5;me.copy(s.vertexNormalsModel[o]).applyMatrix3(xe);oe=.5*me.x+.5;ae=.5*me.y+.5;me.copy(s.vertexNormalsModel[a]).applyMatrix3(xe);se=.5*me.x+.5;le=.5*me.y+.5;be(B,W,P,k,N,F,ie,ne,oe,ae,se,le,l.envMap)}}else{J.copy(l.color);if(l.vertexColors===THREE.FaceColors){J.multiply(s.color)}l.wireframe===true?Se(J,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):Me(J)}}}else{if(l instanceof THREE.MeshNormalMaterial){me.copy(s.normalModel).applyMatrix3(xe);J.setRGB(me.x,me.y,me.z).multiplyScalar(.5).addScalar(.5);l.wireframe===true?Se(J,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):Me(J)}else{J.setRGB(1,1,1);l.wireframe===true?Se(J,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):Me(J)}}}}function He(e,r,t,i,n,o){v.beginPath();v.moveTo(e,r);v.lineTo(t,i);v.lineTo(n,o);v.closePath()}function Se(e,r,t,i){Oe(r);Be(t);We(i);Pe(e.getStyle());v.stroke();pe.expandByScalar(r*2)}function Me(e){ke(e.getStyle());v.fill()}function Ce(e){if(e.version===0||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture){return{canvas:undefined,version:e.version}}var r=e.image;if(r.complete===false){return{canvas:undefined,version:0}}var t=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping;var i=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping;var n=e.wrapS===THREE.MirroredRepeatWrapping;var o=e.wrapT===THREE.MirroredRepeatWrapping;var a=document.createElement("canvas");a.width=r.width*(n?2:1);a.height=r.height*(o?2:1);var s=a.getContext("2d");s.setTransform(1,0,0,-1,0,r.height);s.drawImage(r,0,0);if(n===true){s.setTransform(-1,0,0,-1,r.width,r.height);s.drawImage(r,-r.width,0)}if(o===true){s.setTransform(1,0,0,1,0,0);s.drawImage(r,0,r.height)}if(n===true&&o===true){s.setTransform(-1,0,0,1,r.width,0);s.drawImage(r,-r.width,r.height)}var l="no-repeat";if(t===true&&i===true){l="repeat"}else{if(t===true){l="repeat-x"}else{if(i===true){l="repeat-y"}}}var c=v.createPattern(a,l);if(e.onUpdate){e.onUpdate(e)}return{canvas:c,version:e.version}}function be(e,r,t,i,n,o,a,s,l,c,f,p,u){var d=ee[u.id];if(d===undefined||d.version!==u.version){d=Ce(u);ee[u.id]=d}if(d.canvas!==undefined){ke(d.canvas)}else{ke("rgba( 0, 0, 0, 1)");v.fill();return}var E,h,m,x,R,y,T,w,g=u.offset.x/u.repeat.x,H=u.offset.y/u.repeat.y,S=u.image.width*u.repeat.x,M=u.image.height*u.repeat.y;a=(a+g)*S;s=(s+H)*M;l=(l+g)*S;c=(c+H)*M;f=(f+g)*S;p=(p+H)*M;t-=e;i-=r;n-=e;o-=r;l-=a;c-=s;f-=a;p-=s;T=l*p-f*c;if(T===0){return}w=1/T;E=(p*t-c*n)*w;h=(p*i-c*o)*w;m=(l*n-f*t)*w;x=(l*o-f*i)*w;R=e-E*a-m*s;y=r-h*a-x*s;v.save();v.transform(E,h,m,x,R,y);v.fill();v.restore()}function ze(e,r,t,i,n,o,a,s,l,c,f,p,u){var d,E,h,m,x,R,y,T,w=u.width-1,g=u.height-1;a*=w;s*=g;l*=w;c*=g;f*=w;p*=g;t-=e;i-=r;n-=e;o-=r;l-=a;c-=s;f-=a;p-=s;y=l*p-f*c;T=1/y;d=(p*t-c*n)*T;E=(p*i-c*o)*T;h=(l*n-f*t)*T;m=(l*o-f*i)*T;x=e-d*a-h*s;R=r-E*a-m*s;v.save();v.transform(d,E,h,m,x,R);v.clip();v.drawImage(u,0,0);v.restore()}function Ve(e,r,t){var i=r.x-e.x,n=r.y-e.y,o=i*i+n*n,a;if(o===0){return}a=t/Math.sqrt(o);i*=a;n*=a;r.x+=i;r.y+=n;e.x-=i;e.y-=n}function je(e){if(R!==e){v.globalAlpha=e;R=e}}function Le(e){if(y!==e){if(e===THREE.NormalBlending){v.globalCompositeOperation="source-over"}else{if(e===THREE.AdditiveBlending){v.globalCompositeOperation="lighter"}else{if(e===THREE.SubtractiveBlending){v.globalCompositeOperation="darker"}else{if(e===THREE.MultiplyBlending){v.globalCompositeOperation="multiply"}}}}y=e}}function Oe(e){if(g!==e){v.lineWidth=e;g=e}}function Be(e){if(H!==e){v.lineCap=e;H=e}}function We(e){if(S!==e){v.lineJoin=e;S=e}}function Pe(e){if(T!==e){v.strokeStyle=e;T=e}}function ke(e){if(w!==e){v.fillStyle=e;w=e}}function Ne(e){if(M.length!==e.length){v.setLineDash(e);M=e}}};