void function(e,n){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=n(e,true)}else if(typeof define==="function"&&define.amd){define(function(){return n(e,true)})}else{n(e)}}(typeof window!=="undefined"?window:this,function(e,n){"use strict";var t=e.document;var r=t.documentElement;var i=t.body;var a="3.3.0";var o=["initCond","renderElem","renderJiya","renderHanging","correctBiaodian","renderHWS","substCombLigaWithPUA"];var c=function(e,n){return new c.fn.init(e,n)};var s=function(){if(arguments[0]){this.context=arguments[0]}if(arguments[1]){this.condition=arguments[1]}return this};c.version=a;c.fn=c.prototype={version:a,constructor:c,context:i,condition:r,routine:o,init:s,setRoutine:function(e){if(Array.isArray(e)){this.routine=e}return this},render:function(e){var n=this;var e=Array.isArray(e)?e:this.routine;e.forEach(function(e){if(typeof e==="string"&&typeof n[e]==="function"){n[e]()}else if(Array.isArray(e)&&typeof n[e[0]]==="function"){n[e.shift()].apply(n,e)}});return this}};c.fn.init.prototype=c.fn;c.init=function(){return c.init=c().render()};var u={punct:{base:"[…,.;:!?‽_]",sing:"[‐-—…]",middle:"[\\/~\\-&‐-—_]",open:"['\"‘“\\(\\[¡¿⸘«‹‚“„]",close:"['\"”’\\)\\]»›‛”‟]",end:"['\"”’\\)\\]»›‛”‟‼‽⁇-⁉,.;:!?]"},biaodian:{base:"[︰．、，。：；？！ー]",liga:"[—…⋯]",middle:"[·＼／－゠＆・＿]",open:"[「『《〈（〔［｛【〖]",close:"[」』》〉）〕］｝】〗]",end:"[」』》〉）〕］｝】〗︰．、，。：；？！ー]"},hanzi:{base:"[一-鿿㐀-䶵㇀-㇣〇﨎﨏﨑﨓﨔﨟﨡﨣﨤﨧-﨩]|[�-�][�-�]",desc:"[⿰-⿺]",radical:"[⼀-⿕⺀-⻳]"},latin:{base:"[A-Za-z0-9À-ÿĀ-ſƀ-ɏⱠ-Ɀ꜠-ꟿḀ-ỿ]",combine:"[̀-́᷀-᷿]"},ellinika:{base:"[0-9Ͱ-Ͽἀ-῿]",combine:"[̀-᷀ͅ-᷿]"},kirillica:{base:"[0-9Ѐ-҂Ҋ-ӿԀ-ԯꙀ-ꙮ꙾-ꚗ]",combine:"[҃-҉ⷠ-ⷿ꙯-꙽ꚟ]"},kana:{base:"[アイウエオ-ヺあいうえお-ゔゟヿ]|�[�-�]",small:"[ぁぃぅぇぉァィゥェォっゃゅょゎゕゖッャュョヮヵヶㇰ-ㇿ]",combine:"[゙-゜]",half:"[ｦ-ﾟ]",mark:"[゠ゝゞ・-ヾ]"},eonmun:{base:"[가-힣]",letter:"[ᄀ-ᇿㅏ-ㅣㄱ-ㆎꥠ-ꥼힰ-ퟻ]",half:"[ﾡ-ￜ]"},zhuyin:{base:"[ㄅ-ㄭㆠ-ㆺ]",initial:"[ㄅ-ㄙㄪ-ㄬㆠ-ㆣ]",medial:"[ㄧ-ㄩ]","final":"[ㄚ-ㄩㄭㆤ-ㆳㆸ-ㆺ]",tone:"[˙ˊ˅ˇˋ˪˫]",checked:"[ㆴ-ㆷ][̍͘]?"}};var d=function(){var e="[\\x20\\t\\r\\n\\f]";var n=u.punct.open;var t=u.punct.close;var r=u.punct.end;var i=u.punct.middle;var a=u.punct.sing;var o=n+"|"+r+"|"+i;var c=u.biaodian.open;var s=u.biaodian.close;var d=u.biaodian.end;var l=u.biaodian.middle;var h=u.biaodian.liga+"{2}";var f=c+"|"+d+"|"+l;var p=u.kana.base+u.kana.combine+"?";var v=u.kana.small+u.kana.combine+"?";var g=u.kana.half;var b=u.eonmun.base+"|"+u.eonmun.letter;var m=u.eonmun.half;var y=u.hanzi.base+"|"+u.hanzi.desc+"|"+u.hanzi.radical+"|"+p;var x=u.ellinika.combine;var E=u.latin.base+x+"*";var w=u.ellinika.base+x+"*";var N=u.kirillica.combine;var C=u.kirillica.base+N+"*";var T=E+"|"+w+"|"+C;var S="['’]";var L=y+"|(?:"+T+"|"+S+")+";var k=u.zhuyin.initial;var z=u.zhuyin.medial;var I=u.zhuyin.final;var M=u.zhuyin.tone+"|"+u.zhuyin.checked;return{"char":{punct:{all:new RegExp("("+o+")","g"),open:new RegExp("("+n+")","g"),end:new RegExp("("+r+")","g"),sing:new RegExp("("+a+")","g")},biaodian:{all:new RegExp("("+f+")","g"),open:new RegExp("("+c+")","g"),close:new RegExp("("+s+")","g"),end:new RegExp("("+d+")","g"),liga:new RegExp("("+h+")","g")},hanzi:new RegExp("("+y+")","g"),latin:new RegExp("("+E+")","ig"),ellinika:new RegExp("("+w+")","ig"),kirillica:new RegExp("("+C+")","ig"),kana:new RegExp("("+p+"|"+v+"|"+g+")","g"),eonmun:new RegExp("("+b+"|"+m+")","g")},group:{biaodian:[new RegExp("(("+f+"){2,})","g"),new RegExp("("+h+c+")","g")],punct:null,hanzi:new RegExp("("+y+")+","g"),western:new RegExp("("+E+"|"+w+"|"+C+"|"+o+")+","ig"),kana:new RegExp("("+p+"|"+v+"|"+g+")+","g"),eonmun:new RegExp("("+b+"|"+m+"|"+o+")+","g")},jinze:{hanging:new RegExp(e+"*([、，。．])(?!"+d+")","ig"),touwei:new RegExp("("+c+"+)("+L+")("+d+"+)","ig"),tou:new RegExp("("+c+"+)("+L+")","ig"),wei:new RegExp("("+L+")("+d+"+)","ig"),middle:new RegExp("("+L+")("+l+")("+L+")","ig")},zhuyin:{form:new RegExp("^˙?("+k+")?("+z+")?("+I+")?("+M+")?$"),diao:new RegExp("("+M+")","g")},hws:{base:[new RegExp("("+y+")("+T+"|"+n+")","ig"),new RegExp("("+T+"|"+r+")("+y+")","ig")],strict:[new RegExp("("+y+")"+e+"?("+T+"|"+n+")","ig"),new RegExp("("+T+"|"+r+")"+e+"?("+y+")","ig")]},"display-as":{"ja-font-for-hant":["查 査","啟 啓","鄉 鄕","值 値","污 汚"],"comb-liga-pua":[["a[̍͘]","󰁡"],["e[̍͘]","󰁥"],["i[̍͘]","󰁩"],["o[̍͘]","󰁯"],["u[̍͘]","󰁵"],["ㆴ[̍͘]","󳆴"],["ㆵ[̍͘]","󳆵"],["ㆶ[̍͘]","󳆶"],["ㆷ[̍͘]","󳆷"]],"comb-liga-vowel":[["a[̍͘]","󰁡"],["e[̍͘]","󰁥"],["i[̍͘]","󰁩"],["o[̍͘]","󰁯"],["u[̍͘]","󰁵"]],"comb-liga-zhuyin":[["ㆴ[̍͘]","󳆴"],["ㆵ[̍͘]","󳆵"],["ㆶ[̍͘]","󳆶"],["ㆷ[̍͘]","󳆷"]]},"inaccurate-char":[["[•‧]","·"],["⋯⋯","……"],["──","——"],["‵","‘"],["′","’"],["‶","“"],["″","”"]]}}();c.UNICODE=u;c.TYPESET=d;c.UNICODE.cjk=c.UNICODE.hanzi;c.UNICODE.greek=c.UNICODE.ellinika;c.UNICODE.cyrillic=c.UNICODE.kirillica;c.UNICODE.hangul=c.UNICODE.eonmun;c.UNICODE.zhuyin.ruyun=c.UNICODE.zhuyin.checked;c.TYPESET.char.cjk=c.TYPESET.char.hanzi;c.TYPESET.char.greek=c.TYPESET.char.ellinika;c.TYPESET.char.cyrillic=c.TYPESET.char.kirillica;c.TYPESET.char.hangul=c.TYPESET.char.eonmun;c.TYPESET.group.hangul=c.TYPESET.group.eonmun;c.TYPESET.group.cjk=c.TYPESET.group.hanzi;var l={id:function(e,n){return(n||t).getElementById(e)},tag:function(e,n){return this.makeArray((n||t).getElementsByTagName(e))},qs:function(e,n){return(n||t).querySelector(e)},qsa:function(e,n){return this.makeArray((n||t).querySelectorAll(e))},parent:function(e,n){return n?function(){if(typeof l.matches!=="function")return;while(!l.matches(e,n)){if(!e||e===t.documentElement){e=undefined;break}e=e.parentNode}return e}():e?e.parentNode:undefined},create:function(e,n){var r="!"===e?t.createDocumentFragment():""===e?t.createTextNode(n||""):t.createElement(e);try{if(n){r.className=n}}catch(i){}return r},clone:function(e,n){return e.cloneNode(typeof n==="boolean"?n:true)},remove:function(e){return e.parentNode.removeChild(e)},setAttr:function(e,n){if(typeof n!=="object")return;var t=n.length;if(typeof n[0]==="object"&&"name"in n[0]){for(var r=0;r<t;r++){if(n[r].value!==undefined){e.setAttribute(n[r].name,n[r].value)}}}else{for(var i in n){if(n.hasOwnProperty(i)&&n[i]!==undefined){e.setAttribute(i,n[i])}}}return e},isElmt:function(e){return e&&e.nodeType===Node.ELEMENT_NODE},isIgnorable:function(e){if(!e)return false;return e.nodeName==="WBR"||e.nodeType===Node.COMMENT_NODE},makeArray:function(e){return Array.prototype.slice.call(e)},extend:function(e,n){if((typeof e==="object"||typeof e==="function")&&typeof n==="object"){for(var t in n){if(n.hasOwnProperty(t)){e[t]=n[t]}}}return e}};var h=function(n){"use strict";var t="0.2.1";var r=n.NON_INLINE_PROSE;var i=n.PRESETS.prose.filterElements;var a=e||{};var o=a.document||undefined;function c(e,n,t){var r=Element.prototype;var i=r.matches||r.mozMatchesSelector||r.msMatchesSelector||r.webkitMatchesSelector;if(e instanceof Element){return i.call(e,n)}else if(t){if(/^[39]$/.test(e.nodeType))return true}return false}if(typeof o==="undefined")throw new Error("Fibre requires a DOM-supported environment.");var s=function(e,n){return new s.fn.init(e,n)};s.version=t;s.matches=c;s.fn=s.prototype={constructor:s,version:t,finder:[],context:undefined,portionMode:"retain",selector:{},preset:"prose",init:function(e,n){if(!!n)this.preset=null;this.selector={context:null,filter:[],avoid:[],boundary:[]};if(!e){throw new Error("A context is required for Fibre to initialise.")}else if(e instanceof Node){if(e instanceof Document)this.context=e.body||e;else this.context=e}else if(typeof e==="string"){this.context=o.querySelector(e);this.selector.context=e}return this},filterFn:function(e){var n=this.selector.filter.join(", ")||"*";var t=this.selector.avoid.join(", ")||null;var r=c(e,n,true)&&!c(e,t);return this.preset==="prose"?i(e)&&r:r},boundaryFn:function(e){var n=this.selector.boundary.join(", ")||null;var t=c(e,n);return this.preset==="prose"?r(e)||t:t},filter:function(e){if(typeof e==="string"){this.selector.filter.push(e)}return this},endFilter:function(e){if(e){this.selector.filter=[]}else{this.selector.filter.pop()}return this},avoid:function(e){if(typeof e==="string"){this.selector.avoid.push(e)}return this},endAvoid:function(e){if(e){this.selector.avoid=[]}else{this.selector.avoid.pop()}return this},addBoundary:function(e){if(typeof e==="string"){this.selector.boundary.push(e)}return this},removeBoundary:function(){this.selector.boundary=[];return this},setMode:function(e){this.portionMode=e==="first"?"first":"retain";return this},replace:function(e,t){var r=this;r.finder.push(n(r.context,{find:e,replace:t,filterElements:function(e){return r.filterFn(e)},forceContext:function(e){return r.boundaryFn(e)},portionMode:r.portionMode}));return r},wrap:function(e,t){var r=this;r.finder.push(n(r.context,{find:e,wrap:t,filterElements:function(e){return r.filterFn(e)},forceContext:function(e){return r.boundaryFn(e)},portionMode:r.portionMode}));return r},revert:function(e){var n=this.finder.length;var e=Number(e)||(e===0?Number(0):e==="all"?n:1);if(typeof n==="undefined"||n===0)return this;else if(e>n)e=n;for(var t=e;t>0;t--){this.finder.pop().revert()}return this}};s.fn.filterOut=s.fn.avoid;s.fn.init.prototype=s.fn;return s}(function(){var e="retain";var n="first";var r=t;var i={}.toString;var a={}.hasOwnProperty;function o(e){return i.call(e)=="[object Array]"}function c(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function s(){return u.apply(null,arguments)||d.apply(null,arguments)}function u(e,n,t,r,i){if(n&&!n.nodeType&&arguments.length<=2){return false}var a=typeof t=="function";if(a){t=function(e){return function(n,t){return e(n.text,t.startIndex)}}(t)}var o=d(n,{find:e,wrap:a?null:t,replace:a?t:"$"+(r||"&"),prepMatch:function(e,n){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(r>0){var t=e[r];e.index+=e[0].indexOf(t);e[0]=t}e.endIndex=e.index+e[0].length;e.startIndex=e.index;e.index=n;return e},filterElements:i});s.revert=function(){return o.revert()};return true}function d(e,n){return new l(e,n)}s.NON_PROSE_ELEMENTS={br:1,hr:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1};s.NON_CONTIGUOUS_PROSE_ELEMENTS={address:1,article:1,aside:1,blockquote:1,dd:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,nav:1,noscript:1,ol:1,output:1,p:1,pre:1,section:1,ul:1,br:1,li:1,summary:1,dt:1,details:1,rp:1,rt:1,rtc:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1,table:1,tbody:1,thead:1,th:1,tr:1,td:1,caption:1,col:1,tfoot:1,colgroup:1};s.NON_INLINE_PROSE=function(e){return a.call(s.NON_CONTIGUOUS_PROSE_ELEMENTS,e.nodeName.toLowerCase())};s.PRESETS={prose:{forceContext:s.NON_INLINE_PROSE,filterElements:function(e){return!a.call(s.NON_PROSE_ELEMENTS,e.nodeName.toLowerCase())}}};s.Finder=l;function l(n,t){var r=t.preset&&s.PRESETS[t.preset];t.portionMode=t.portionMode||e;if(r){for(var i in r){if(a.call(r,i)&&!a.call(t,i)){t[i]=r[i]}}}this.node=n;this.options=t;this.prepMatch=t.prepMatch||this.prepMatch;this.reverts=[];this.matches=this.search();if(this.matches.length){this.processMatches()}}l.prototype={search:function(){var e;var n=0;var t=0;var r=this.options.find;var i=this.getAggregateText();var a=[];var o=this;r=typeof r==="string"?RegExp(c(r),"g"):r;s(i);function s(i){for(var c=0,u=i.length;c<u;++c){var d=i[c];if(typeof d!=="string"){s(d);continue}if(r.global){while(e=r.exec(d)){a.push(o.prepMatch(e,n++,t))}}else{if(e=d.match(r)){a.push(o.prepMatch(e,0,t))}}t+=d.length}}return a},prepMatch:function(e,n,t){if(!e[0]){throw new Error("findAndReplaceDOMText cannot handle zero-length matches")}e.endIndex=t+e.index+e[0].length;e.startIndex=t+e.index;e.index=n;return e},getAggregateText:function(){var e=this.options.filterElements;var n=this.options.forceContext;return t(this.node);function t(r,i){if(r.nodeType===3){return[r.data]}if(e&&!e(r)){return[]}var i=[""];var a=0;if(r=r.firstChild)do{if(r.nodeType===3){i[a]+=r.data;continue}var o=t(r);if(n&&r.nodeType===1&&(n===true||n(r))){i[++a]=o;i[++a]=""}else{if(typeof o[0]==="string"){i[a]+=o.shift()}if(o.length){i[++a]=o;i[++a]=""}}}while(r=r.nextSibling);return i}},processMatches:function(){var e=this.matches;var n=this.node;var t=this.options.filterElements;var r,i,a=[],o=n,c=e.shift(),s=0,u=0,d=0,l,h=[n];e:while(true){if(o.nodeType===3){if(!i&&o.length+s>=c.endIndex){i={node:o,index:d++,text:o.data.substring(c.startIndex-s,c.endIndex-s),indexInMatch:s-c.startIndex,indexInNode:c.startIndex-s,endIndexInNode:c.endIndex-s,isEnd:true}}else if(r){a.push({node:o,index:d++,text:o.data,indexInMatch:s-c.startIndex,indexInNode:0})}if(!r&&o.length+s>c.startIndex){r={node:o,index:d++,indexInMatch:0,indexInNode:c.startIndex-s,endIndexInNode:c.endIndex-s,text:o.data.substring(c.startIndex-s,c.endIndex-s)}}s+=o.data.length}l=o.nodeType===1&&t&&!t(o);if(r&&i){o=this.replaceMatch(c,r,a,i);s-=i.node.data.length-i.endIndexInNode;r=null;i=null;a=[];c=e.shift();d=0;u++;if(!c){break}}else if(!l&&(o.firstChild||o.nextSibling)){if(o.firstChild){h.push(o);o=o.firstChild}else{o=o.nextSibling}continue}while(true){if(o.nextSibling){o=o.nextSibling;break}o=h.pop();if(o===n){break e}}}},revert:function(){for(var e=this.reverts.length;e--;){this.reverts[e]()}this.reverts=[]},prepareReplacementString:function(e,t,r,i){var a=this.options.portionMode;if(a===n&&t.indexInMatch>0){return""}e=e.replace(/\$(\d+|&|`|')/g,function(e,n){var t;switch(n){case"&":t=r[0];break;case"`":t=r.input.substring(0,r.startIndex);break;case"'":t=r.input.substring(r.endIndex);break;default:t=r[+n]}return t});if(a===n){return e}if(t.isEnd){return e.substring(t.indexInMatch)}return e.substring(t.indexInMatch,t.indexInMatch+t.text.length)},getPortionReplacementNode:function(e,n,t){var i=this.options.replace||"$&";var a=this.options.wrap;if(a&&a.nodeType){var o=r.createElement("div");o.innerHTML=a.outerHTML||(new XMLSerializer).serializeToString(a);a=o.firstChild}if(typeof i=="function"){i=i(e,n,t);if(i&&i.nodeType){return i}return r.createTextNode(String(i))}var c=typeof a=="string"?r.createElement(a):a;i=r.createTextNode(this.prepareReplacementString(i,e,n,t));if(!i.data){return i}if(!c){return i}c.appendChild(i);return c},replaceMatch:function(e,n,t,i){var a=n.node;var o=i.node;var c;var s;if(a===o){var u=a;if(n.indexInNode>0){c=r.createTextNode(u.data.substring(0,n.indexInNode));u.parentNode.insertBefore(c,u)}var d=this.getPortionReplacementNode(i,e);u.parentNode.insertBefore(d,u);if(i.endIndexInNode<u.length){s=r.createTextNode(u.data.substring(i.endIndexInNode));u.parentNode.insertBefore(s,u)}u.parentNode.removeChild(u);this.reverts.push(function(){if(c===d.previousSibling){c.parentNode.removeChild(c)}if(s===d.nextSibling){s.parentNode.removeChild(s)}d.parentNode.replaceChild(u,d)});return d}else{c=r.createTextNode(a.data.substring(0,n.indexInNode));s=r.createTextNode(o.data.substring(i.endIndexInNode));var l=this.getPortionReplacementNode(n,e);var h=[];for(var f=0,p=t.length;f<p;++f){var v=t[f];var g=this.getPortionReplacementNode(v,e);v.node.parentNode.replaceChild(g,v.node);this.reverts.push(function(e,n){return function(){n.parentNode.replaceChild(e.node,n)}}(v,g));h.push(g)}var b=this.getPortionReplacementNode(i,e);a.parentNode.insertBefore(c,a);a.parentNode.insertBefore(l,a);a.parentNode.removeChild(a);o.parentNode.insertBefore(b,o);o.parentNode.insertBefore(s,o);o.parentNode.removeChild(o);this.reverts.push(function(){c.parentNode.removeChild(c);l.parentNode.replaceChild(a,l);s.parentNode.removeChild(s);b.parentNode.replaceChild(o,b)});return b}}};return s}());var f=function(){var e=l.create("div");e.appendChild(l.create("","0-"));e.appendChild(l.create("","2"));e.normalize();return e.firstChild.length!==2}();function p(e){return typeof e==="function"||e instanceof Element?e:undefined}function v(e){var n=e.index===0&&e.isEnd?"biaodian cjk":"biaodian cjk portion "+(e.index===0?"is-first":e.isEnd?"is-end":"is-inner");var t=l.create("h-char-group",n);t.innerHTML=e.text;return t}function g(e){var n=l.create("div");var t=e.charCodeAt(0).toString(16);n.innerHTML='<h-char unicode="'+t+'" class="biaodian cjk '+b(e)+'">'+e+"</h-char>";return n.firstChild}function b(e){return e.match(d.char.biaodian.open)?"bd-open":e.match(d.char.biaodian.close)?"bd-close bd-end":e.match(d.char.biaodian.end)?/(?:\u3001|\u3002|\uff0c)/i.test(e)?"bd-end bd-cop":"bd-end":e.match(new RegExp(u.biaodian.liga))?"bd-liga":e.match(new RegExp(u.biaodian.middle))?"bd-middle":""}l.extend(h.fn,{normalize:function(){if(f){this.context.normalize()}return this},jinzify:function(e){return this.filter(e||null).avoid("h-jinze").replace(d.jinze.touwei,function(e,n){var t=l.create("h-jinze","touwei");t.innerHTML=n[0];return e.index===0&&e.isEnd||e.index===1?t:""}).replace(d.jinze.wei,function(e,n){var t=l.create("h-jinze","wei");t.innerHTML=n[0];return e.index===0?t:""}).replace(d.jinze.tou,function(e,n){var t=l.create("h-jinze","tou");t.innerHTML=n[0];return e.index===0&&e.isEnd||e.index===1?t:""}).replace(d.jinze.middle,function(e,n){var t=l.create("h-jinze","middle");t.innerHTML=n[0];return e.index===0&&e.isEnd||e.index===1?t:""}).endAvoid().endFilter()},groupify:function(e){var e=l.extend({biaodian:false,hanzi:false,kana:false,eonmun:false,western:false},e||{});this.avoid("h-word, h-char-group");if(e.biaodian){this.replace(d.group.biaodian[0],v).replace(d.group.biaodian[1],v)}if(e.hanzi||e.cjk){this.wrap(d.group.hanzi,l.clone(l.create("h-char-group","hanzi cjk")))}if(e.western){this.wrap(d.group.western,l.clone(l.create("h-word","western")))}if(e.kana){this.wrap(d.group.kana,l.clone(l.create("h-char-group","kana")))}if(e.eonmun||e.hangul){this.wrap(d.group.eonmun,l.clone(l.create("h-word","eonmun hangul")))}this.endAvoid();return this},charify:function(e){var e=l.extend({avoid:true,biaodian:false,punct:false,hanzi:false,latin:false,ellinika:false,kirillica:false,kana:false,eonmun:false},e||{});if(e.avoid){this.avoid("h-char")}if(e.biaodian){this.replace(d.char.biaodian.all,p(e.biaodian)||function(e){return g(e.text)}).replace(d.char.biaodian.liga,p(e.biaodian)||function(e){return g(e.text)})}if(e.hanzi||e.cjk){this.wrap(d.char.hanzi,p(e.hanzi||e.cjk)||l.clone(l.create("h-char","hanzi cjk")))}if(e.punct){this.wrap(d.char.punct.all,p(e.punct)||l.clone(l.create("h-char","punct")))}if(e.latin){this.wrap(d.char.latin,p(e.latin)||l.clone(l.create("h-char","alphabet latin")))}if(e.ellinika||e.greek){this.wrap(d.char.ellinika,p(e.ellinika||e.greek)||l.clone(l.create("h-char","alphabet ellinika greek")))}if(e.kirillica||e.cyrillic){this.wrap(d.char.kirillica,p(e.kirillica||e.cyrillic)||l.clone(l.create("h-char","alphabet kirillica cyrillic")))}if(e.kana){this.wrap(d.char.kana,p(e.kana)||l.clone(l.create("h-char","kana")))}if(e.eonmun||e.hangul){this.wrap(d.char.eonmun,p(e.eonmun||e.hangul)||l.clone(l.create("h-char","eonmun hangul")))}this.endAvoid();return this}});l.extend(c,{isNodeNormalizeNormal:f,find:h,createBDGroup:v,createBDChar:g});l.matches=c.find.matches;void["setMode","wrap","replace","revert","addBoundary","removeBoundary","avoid","endAvoid","filter","endFilter","jinzify","groupify","charify"].forEach(function(e){c.fn[e]=function(){if(!this.finder){this.finder=c.find(this.context)}this.finder[e](arguments[0],arguments[1]);return this}});var m={};function y(e,n){var t=l.create("canvas");var r;t.width="50";t.height="20";t.style.display="none";i.appendChild(t);r=t.getContext("2d");r.textBaseline="top";r.font="15px "+n+", sans-serif";r.fillStyle="black";r.strokeStyle="black";r.fillText(e,0,0);return{node:t,context:r,remove:function(){l.remove(t,i)}}}function x(e,n){var t;var r=e.context;var i=n.context;try{for(var a=1;a<=20;a++){for(var o=1;o<=50;o++){if(typeof t==="undefined"&&r.getImageData(o,a,1,1).data[3]!==i.getImageData(o,a,1,1).data[3]){t=false;break}else if(typeof t==="boolean"){break}if(o===50&&a===20&&typeof t==="undefined"){t=true}}}e.remove();n.remove();e=null;n=null;return t}catch(c){}return false}function E(e,n,t){var e=e;var n=n||"sans-serif";var t=t||"辭Q";var r;n=y(t,n);e=y(t,e);return!x(e,n)}m.writeOnCanvas=y;m.compareCanvases=x;m.detectFont=E;m.support=function(){var n="Webkit Moz ms".split(" ");var a=l.create("h-test");function o(e){var t=e.charAt(0).toUpperCase()+e.slice(1);var r=(e+" "+n.join(t+" ")+t).split(" ");var i;r.forEach(function(e){if(typeof a.style[e]==="string"){i=true}});return i||false}function c(e,n){var t=i||l.create("body");var a=l.create("div");var o=i?a:t;var n=typeof n==="function"?n:function(){};var c,s,u;c=["<style>",e,"</style>"].join("");o.innerHTML+=c;t.appendChild(a);if(!i){t.style.background="";t.style.overflow="hidden";u=r.style.overflow;r.style.overflow="hidden";r.appendChild(t)}s=n(o,e);l.remove(o);if(!i){r.style.overflow=u}return!!s}function s(n,r){var i;if(e.getComputedStyle){i=t.defaultView.getComputedStyle(n,null).getPropertyValue(r)}else if(n.currentStyle){i=n.currentStyle[r]}return i}return{columnwidth:o("columnWidth"),fontface:function(){var e;c('@font-face { font-family: font; src: url("//"); }',function(n,t){var r=l.qsa("style",n)[0];var i=r.sheet||r.styleSheet;var a=i?i.cssRules&&i.cssRules[0]?i.cssRules[0].cssText:i.cssText||"":"";e=/src/i.test(a)&&a.indexOf(t.split(" ")[0])===0});return e}(),ruby:function(){var e=l.create("ruby");var n=l.create("rt");var t=l.create("rp");var i;e.appendChild(t);e.appendChild(n);r.appendChild(e);i=s(t,"display")==="none"||s(e,"display")==="ruby"&&s(n,"display")==="ruby-text"?true:false;r.removeChild(e);e=null;n=null;t=null;return i}(),"ruby-display":function(){var e=l.create("div");e.innerHTML='<h-test-a style="display: ruby;"></h-test-a><h-test-b style="display: ruby-text-container;"></h-test-b>';return e.querySelector("h-test-a").style.display==="ruby"&&e.querySelector("h-test-b").style.display==="ruby-text-container"}(),"ruby-interchar":function(){var e="inter-character";var n=l.create("div");var t;n.innerHTML='<h-test style="-moz-ruby-position:'+e+";-ms-ruby-position:"+e+";-webkit-ruby-position:"+e+";ruby-position:"+e+';"></h-test>';t=n.querySelector("h-test").style;return t.rubyPosition===e||t.WebkitRubyPosition===e||t.MozRubyPosition===e||t.msRubyPosition===e}(),textemphasis:o("textEmphasis"),unicoderange:function(){var e;c('@font-face{font-family:test-for-unicode-range;src:local(Arial),local("Droid Sans")}@font-face{font-family:test-for-unicode-range;src:local("Times New Roman"),local(Times),local("Droid Serif");unicode-range:U+270C}',function(){e=!m.detectFont("test-for-unicode-range",'Arial, "Droid Sans"',"Q")});return e}(),writingmode:o("writingMode")}}();m.initCond=function(e){var e=e||r;var n="";var t;for(var i in m.support){t=(m.support[i]?"":"no-")+i;e.classList.add(t);n+=t+" "}return n};var w=m.support["ruby-interchar"];function N(e){var n=l.create("!");var t=e.classList;var r,i;n.appendChild(l.clone(e));l.tag("rt",n.firstChild).forEach(function(e){var n=l.create("!");var r=[];var a;do{a=(a||e).previousSibling;if(!a||a.nodeName.match(/((?:h\-)?r[ubt])/i))break;n.insertBefore(l.clone(a),n.firstChild);r.push(a)}while(!a.nodeName.match(/((?:h\-)?r[ubt])/i));i=t.contains("zhuyin")?z(n,e):k(n,e);try{e.parentNode.replaceChild(i,e);r.map(l.remove)}catch(o){}});return S(n)}function C(e){var n=l.create("!");n.appendChild(l.clone(e));l.tag("rt",n.firstChild).forEach(function(e){var n=l.create("!");var t=[];var r,i;do{r=(r||e).previousSibling;if(!r||r.nodeName.match(/((?:h\-)?r[ubt])/i))break;n.insertBefore(l.clone(r),n.firstChild);t.push(r)}while(!r.nodeName.match(/((?:h\-)?r[ubt])/i));i=l.create("rt");i.innerHTML=I(e);e.parentNode.replaceChild(i,e)});return n.firstChild}function T(e){var n=l.create("!");var t=e.classList;var r,i,a,o;n.appendChild(l.clone(e));r=n.firstChild;i=a=l.tag("rb",r);o=i.length;void function(e){if(!e)return;a=l.tag("rt",e).map(function(e,n){if(!i[n])return;var t=z(i[n],e);try{i[n].parentNode.replaceChild(t,i[n])}catch(r){}return t});l.remove(e);r.setAttribute("rightangle","true")}(r.querySelector("rtc.zhuyin"));l.qsa("rtc:not(.zhuyin)",r).forEach(function(e,n){var i;i=l.tag("rt",e).map(function(e,r){var i=Number(e.getAttribute("rbspan")||1);var c=0;var s=[];var u,d;if(i>o)i=o;do{try{u=a.shift();s.push(u)}catch(h){}if(typeof u==="undefined")break;c+=Number(u.getAttribute("span")||1)}while(i>c);if(i<c){if(s.length>1){console.error("An impossible `rbspan` value detected.",ruby);return}s=l.tag("rb",s[0]);a=s.slice(i).concat(a);s=s.slice(0,i);c=i}d=k(s,e,{"class":t,span:c,order:n});try{s[0].parentNode.replaceChild(d,s.shift());s.map(l.remove)}catch(h){}return d});a=i;if(n===1)r.setAttribute("doubleline","true");l.remove(e)});return S(n)}function S(e){var n=e.firstChild;var t=l.create("h-ruby");t.innerHTML=n.innerHTML;l.setAttr(t,n.attributes);t.normalize();return t}function L(e){if(!e instanceof Element)return e;var n=e.classList;if(n.contains("pinyin"))n.add("romanization");else if(n.contains("romanization"))n.add("annotation");else if(n.contains("mps"))n.add("zhuyin");else if(n.contains("rightangle"))n.add("complex");return e}function k(e,n,t){var r=l.create("h-ru");var n=l.clone(n);var t=t||{};t.annotation="true";if(Array.isArray(e)){r.innerHTML=e.map(function(e){if(typeof e==="undefined")return"";return e.outerHTML}).join("")+n.outerHTML}else{r.appendChild(l.clone(e));r.appendChild(n)}l.setAttr(r,t);return r}function z(e,n){var e=l.clone(e);var t=l.create("h-ru");t.setAttribute("zhuyin",true);t.appendChild(e);t.innerHTML+=I(n);return t}function I(e){var n=typeof e==="string"?e:e.textContent;var t,r,i;t=n.replace(d.zhuyin.diao,"");i=t?t.length:0;r=n.replace(t,"").replace(/[\u02C5]/g,"ˇ").replace(/[\u030D]/g,"͘");return i===0?"":'<h-zhuyin length="'+i+'" diao="'+r+'"><h-yin>'+t+"</h-yin><h-diao>"+r+"</h-diao></h-zhuyin>"}l.extend(m,{renderRuby:function(e,n){var n=n||"ruby";var t=l.qsa(n,e);l.qsa("rtc",e).concat(t).map(L);t.forEach(function(e){var n=e.classList;var t;if(n.contains("complex"))t=T(e);else if(n.contains("zhuyin"))t=w?C(e):N(e);if(t)e.parentNode.replaceChild(t,e)})},simplifyRubyClass:L,getZhuyinHTML:I,renderComplexRuby:T,renderSimpleRuby:N,renderInterCharRuby:C});l.extend(m,{renderElem:function(e){this.renderRuby(e);this.renderDecoLine(e);this.renderDecoLine(e,"s, del");this.renderEm(e)},renderDecoLine:function(e,n){var t=l.qsa(n||"u, ins",e);var r=t.length;e:while(r--){var i=t[r];var a=null;n:do{a=(a||i).previousSibling;if(!a){continue e}else if(t[r-1]===a){i.classList.add("adjacent")}}while(l.isIgnorable(a))}},renderEm:function(e,n){var t=n?"qsa":"tag";var n=n||"em";var r=l[t](n,e);r.forEach(function(e){var n=c(e);if(m.support.textemphasis){n.avoid("rt, h-char").charify({biaodian:true,punct:true})}else{n.avoid("rt, h-char, h-char-group").jinzify().groupify({western:true}).charify({hanzi:true,biaodian:true,punct:true,latin:true,ellinika:true,kirillica:true})}})}});c.normalize=m;c.localize=m;c.support=m.support;c.detectFont=m.detectFont;c.fn.initCond=function(){this.condition.classList.add("han-js-rendered");c.normalize.initCond(this.condition);return this};void["Elem","DecoLine","Em","Ruby"].forEach(function(e){var n="render"+e;c.fn[n]=function(e){c.normalize[n](this.context,e);return this}});l.extend(c.support,{heiti:true,songti:c.detectFont('"Han Songti"'),"songti-gb":c.detectFont('"Han Songti GB"'),kaiti:c.detectFont('"Han Kaiti"'),fangsong:c.detectFont('"Han Fangsong"')});c.correctBiaodian=function(e){var e=e||t;var n=c.find(e);n.avoid("h-char").replace(/([‘“])/g,function(e){var n=c.createBDChar(e.text);n.classList.add("bd-open","punct");return n}).replace(/([’”])/g,function(e){var n=c.createBDChar(e.text);n.classList.add("bd-close","bd-end","punct");return n});return c.support.unicoderange?n:n.charify({biaodian:true})};c.correctBasicBD=c.correctBiaodian;c.correctBD=c.correctBiaodian;l.extend(c.fn,{biaodian:null,correctBiaodian:function(){this.biaodian=c.correctBiaodian(this.context);return this},revertCorrectedBiaodian:function(){try{this.biaodian.revert("all")}catch(e){}return this}});c.fn.correctBasicBD=c.fn.correctBiaodian;c.fn.revertBasicBD=c.fn.revertCorrectedBiaodian;var M="<<hws>>";var R=l.create("h-hws");R.setAttribute("hidden","");R.innerHTML=" ";function j(e,n){return e&&n&&e.parentNode===n.parentNode}function A(e,n){var t=e;var n=n||"";if(l.isElmt(e.nextSibling)||j(e,e.nextSibling)){return n+M}else{while(!t.nextSibling){t=t.parentNode}if(e!==t){t.insertAdjacentHTML("afterEnd","<h-hws hidden> </h-hws>")}}return n}function P(e,n){return e.isEnd&&e.index===0?n[1]+M+n[2]:e.index===0?A(e.node,e.text):e.text}function H(e){return e.index===0?l.clone(R):""}var O;function B(e){var n=e.node.parentNode;if(e.index===0){O=e.endIndexInNode-2}if(n.nodeName.toLowerCase()==="h-hws"&&(e.index===1||e.indexInMatch===O)){n.classList.add("quote-inner")}return e.text}function D(e){var n=e.node.parentNode;if(n.nodeName.toLowerCase()==="h-hws"){n.classList.add("quote-outer")}return e.text}l.extend(c,{renderHWS:function(e,n){var r=n?"textarea, code, kbd, samp, pre":"textarea";var i=n?"strict":"base";var e=e||t;var a=c.find(e);a.avoid(r).replace(c.TYPESET.hws[i][0],P).replace(c.TYPESET.hws[i][1],P).replace(new RegExp("("+M+")+","g"),H).replace(/([\'"])\s(.+?)\s\1/g,B).replace(/\s[‘“]/g,D).replace(/[’”]\s/g,D).normalize();return a}});l.extend(c.fn,{renderHWS:function(e){c.renderHWS(this.context,e);return this},revertHWS:function(){l.tag("h-hws",this.context).forEach(function(e){l.remove(e)});this.HWS=[];return this}});var F="bd-hangable";var q="h-char.bd-hangable";var U='<h-cs hidden class="jinze-outer hangable-outer"> </h-cs>';var _=c.find.matches;function Y(){var e=l.create("div");var n;e.innerHTML="<span>a b</span><span style=\"font-family: 'Han Space'\">a b</span>";i.appendChild(e);n=e.firstChild.offsetWidth!==e.lastChild.offsetWidth;l.remove(e);return n}function W(e){var n=e.nextSibling;if(n&&_(n,"h-cs.jinze-outer")){n.classList.add("hangable-outer")}else{e.insertAdjacentHTML("afterend",U)}}c.support["han-space"]=Y();l.extend(c,{detectSpaceFont:Y,isSpaceFontLoaded:Y(),renderHanging:function(e){var e=e||t;var n=c.find(e);n.avoid("textarea, code, kbd, samp, pre").avoid(q).replace(d.jinze.hanging,function(e){if(/^[\x20\t\r\n\f]+$/.test(e.text)){return""}var n=e.node.parentNode;var t,r,i,a;if(t=l.parent(n,"h-jinze")){W(t)}a=e.text.trim();r=c.createBDChar(a);r.innerHTML="<h-inner>"+a+"</h-inner>";r.classList.add(F);i=l.parent(n,"h-char.biaodian");return!i?r:function(){i.classList.add(F);return _(n,"h-inner, h-inner *")?a:r.firstChild}()});return n}});l.extend(c.fn,{renderHanging:function(){var e=this.condition.classList;c.isSpaceFontLoaded=Y();if(c.isSpaceFontLoaded&&e.contains("no-han-space")){e.remove("no-han-space");e.add("han-space")}c.renderHanging(this.context);return this},revertHanging:function(){l.qsa("h-char.bd-hangable, h-cs.hangable-outer",this.context).forEach(function(e){var n=e.classList;n.remove("bd-hangable");n.remove("hangable-outer")});return this}});var V="bd-jiya";var Z="h-char.bd-jiya";var $="bd-consecutive";var J='<h-cs hidden class="jinze-outer jiya-outer"> </h-cs>';var _=c.find.matches;function G(e){return e.replace(/(biaodian|cjk|bd-jiya|bd-consecutive|bd-hangable)/gi,"").trim()}function K(e){var n=e.text;var t=e.node.parentNode;var r=l.parent(t,"h-char.biaodian");var i=c.createBDChar(n);var a;i.innerHTML="<h-inner>"+n+"</h-inner>";i.classList.add(V);if(a=l.parent(t,"h-jinze")){ne(a)}return!r?i:function(){r.classList.add(V);return _(t,"h-inner, h-inner *")?n:i.firstChild}()}var Q,X;function ee(e){var n=Q;var t=e.node.parentNode;var r=l.parent(t,"h-char.biaodian");var i=l.parent(r,"h-jinze");var a;a=r.classList;if(n){r.setAttribute("prev",n)}if(X&&a.contains("bd-open")){X.pop().setAttribute("next","bd-open")}X=undefined;if(e.isEnd){Q=undefined;a.add($,"end-portion")}else{Q=G(r.getAttribute("class"));a.add($)}if(i){X=te(i,{prev:n,"class":G(r.getAttribute("class"))})}return e.text}function ne(e){if(_(e,".tou, .touwei")&&!_(e.previousSibling,"h-cs.jiya-outer")){e.insertAdjacentHTML("beforebegin",J)}if(_(e,".wei, .touwei")&&!_(e.nextSibling,"h-cs.jiya-outer")){
e.insertAdjacentHTML("afterend",J)}}function te(e,n){var t,r;if(_(e,".tou, .touwei")){t=e.previousSibling;if(_(t,"h-cs")){t.className="jinze-outer jiya-outer";t.setAttribute("prev",n.prev)}}if(_(e,".wei, .touwei")){r=e.nextSibling;if(_(r,"h-cs")){r.className="jinze-outer jiya-outer "+n["class"];r.removeAttribute("prev")}}return[t,r]}c.renderJiya=function(e){var e=e||t;var n=c.find(e);n.avoid("textarea, code, kbd, samp, pre, h-cs").avoid(Z).charify({avoid:false,biaodian:K}).endAvoid().avoid("textarea, code, kbd, samp, pre, h-cs").replace(d.group.biaodian[0],ee).replace(d.group.biaodian[1],ee);return n};l.extend(c.fn,{renderJiya:function(){c.renderJiya(this.context);return this},revertJiya:function(){l.qsa("h-char.bd-jiya, h-cs.jiya-outer",this.context).forEach(function(e){var n=e.classList;n.remove("bd-jiya");n.remove("jiya-outer")});return this}});var re="h-ru[annotation]";var ie="textarea, code, kbd, samp, pre";function ae(e,n,t){return function(){var r=c.localize.writeOnCanvas(n,e);var i=c.localize.writeOnCanvas(t,e);return c.localize.compareCanvases(r,i)}}function oe(){return ae('"Romanization Sans"',"a̍","󰁡")}function ce(){return ae('"Romanization Sans"',"i̍","󰁩")}function se(){return ae('"Zhuyin Kaiti"',"ㆴ͘","󳆴")}function ue(e){return function(n){var n=n||t;var r=c.find(n).avoid(ie);e.forEach(function(e){r.replace(new RegExp(e[0],"ig"),function(n,t){var r=l.clone(de);r.innerHTML="<h-inner>"+t[0]+"</h-inner>";r.setAttribute("display-as",e[1]);return n.index===0?r:""})});return r}}var de=l.create("h-char","comb-liga");l.extend(c,{isVowelCombLigaNormal:oe(),isVowelICombLigaNormal:ce(),isZhuyinCombLigaNormal:se(),isCombLigaNormal:ce()(),substVowelCombLiga:ue(c.TYPESET["display-as"]["comb-liga-vowel"]),substZhuyinCombLiga:ue(c.TYPESET["display-as"]["comb-liga-zhuyin"]),substCombLigaWithPUA:ue(c.TYPESET["display-as"]["comb-liga-pua"]),substInaccurateChar:function(e){var e=e||t;var n=c.find(e);n.avoid(ie);c.TYPESET["inaccurate-char"].forEach(function(e){n.replace(new RegExp(e[0],"ig"),e[1])})}});l.extend(c.fn,{"comb-liga-vowel":null,"comb-liga-vowel-i":null,"comb-liga-zhuyin":null,"inaccurate-char":null,substVowelCombLiga:function(){this["comb-liga-vowel"]=c.substVowelCombLiga(this.context);return this},substVowelICombLiga:function(){this["comb-liga-vowel-i"]=c.substVowelICombLiga(this.context);return this},substZhuyinCombLiga:function(){this["comb-liga-zhuyin"]=c.substZhuyinCombLiga(this.context);return this},substCombLigaWithPUA:function(){if(!c.isVowelCombLigaNormal()){this["comb-liga-vowel"]=c.substVowelCombLiga(this.context)}else if(!c.isVowelICombLigaNormal()){this["comb-liga-vowel-i"]=c.substVowelICombLiga(this.context)}if(!c.isZhuyinCombLigaNormal()){this["comb-liga-zhuyin"]=c.substZhuyinCombLiga(this.context)}return this},revertVowelCombLiga:function(){try{this["comb-liga-vowel"].revert("all")}catch(e){}return this},revertVowelICombLiga:function(){try{this["comb-liga-vowel-i"].revert("all")}catch(e){}return this},revertZhuyinCombLiga:function(){try{this["comb-liga-zhuyin"].revert("all")}catch(e){}return this},revertCombLigaWithPUA:function(){try{this["comb-liga-vowel"].revert("all");this["comb-liga-vowel-i"].revert("all");this["comb-liga-zhuyin"].revert("all")}catch(e){}return this},substInaccurateChar:function(){this["inaccurate-char"]=c.substInaccurateChar(this.context);return this},revertInaccurateChar:function(){try{this["inaccurate-char"].revert("all")}catch(e){}return this}});e.addEventListener("DOMContentLoaded",function(){var e;if(r.classList.contains("han-init")){c.init()}else if(e=t.querySelector(".han-init-context")){c.init=c(e).render()}});if(typeof n==="undefined"||n===false){e.Han=c}return c});